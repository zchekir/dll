///////////////////////////////////////////////////////////////////////////////
//
// This file was automatically generated by RANOREX.
// Your custom recording code should go in this file.
// The designer will only add methods to this file, so your custom code won't be overwritten.
// http://www.ranorex.com
//
///////////////////////////////////////////////////////////////////////////////
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient;
using System.Drawing;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading;
using WinForms = System.Windows.Forms;

using Ranorex;
using Ranorex.Core;
using Ranorex.Core.Repository;
using Ranorex.Core.Testing;

namespace CSP.DatabaseModules
{
	public partial class Check_Duplicate_Study
	{
		public static DataTable dt = new DataTable();
		/// <summary>
		/// This method gets called right after the recording has been started.
		/// It can be used to execute recording specific initialization code.
		/// </summary>
		private void Init()
		{
			// Your recording specific initialization code goes here.
		}

		public void StudyDupplicationTest(string dbserver, string database, string username, string password, string Authentication)
		{
			dt.Reset();
			
			// QueryDB
			string query = @"SELECT CodeName, COUNT(1) AS entries FROM Study.Stud
            GROUP BY CodeName
            ORDER BY entries DESC";
			
			//Connecting to SQL DB:
			string sqlConnString = string.Format("Server={0};Database={1};User Id={2};Password={3};Authentication={4};Connection Timeout={5};", dbserver, database, username, password, Authentication, "30");
			
			//CreateObject:
			SqlDataAdapter da = new SqlDataAdapter(query, sqlConnString);
			
			//da.SelectCommand.Parameters.AddWithValue("@ExternalID", ExternalID);
			// Get the data from DB
			using (da)
			{
				da.Fill(dt);
			}
			
			foreach( System.Data.DataRow r in dt.Rows){
				
				
				if ((int)r[1]>1){
					Report.Failure("Duplicated StudyCodeName is " + r[0]+" "+r[1] );
				}
				
				
			}
			// If there is not dupp study print this string,
			Report.Log(ReportLevel.Info, "There is zero dupplication study in DB " );
			
		}

	}
}

